<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Literature.exe</title>

<style>
html,body{
  margin:0;
  height:100%;
  overflow:hidden;
  font-family:monospace;
  color:white;
  background:black;
}

body{
  background:url("Club.png") center / cover no-repeat fixed;
}

#loginScreen{
  position:fixed;
  inset:0;
  background:black;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:999;
}

input,button{
  padding:10px;
  margin:5px;
  font-family:monospace;
}

button{
  background:black;
  color:white;
  border:1px solid #ff6fa9;
  cursor:pointer;
}

button:hover{
  background:#ff6fa9;
  color:black;
}

#overlay{
  display:flex;
  height:100vh;
}

#main{
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}

#logo{
  width:340px;
  cursor:pointer;
}

.bounce{
  animation:bounce .15s;
}

@keyframes bounce{
  0%{transform:scale(1)}
  50%{transform:scale(.95)}
  100%{transform:scale(1)}
}

#shop{
  width:300px;
  background:rgba(0,0,0,.9);
  padding:10px;
  overflow-y:auto;
}

.upgrade{
  border:1px solid #444;
  padding:8px;
  margin-bottom:8px;
}

#statsBar{
  position:fixed;
  bottom:10px;
  left:10px;
  background:rgba(0,0,0,.8);
  border:1px solid #ff6fa9;
  padding:10px;
}

.toast{
  position:fixed;
  bottom:80px;
  left:10px;
  background:#ff6fa9;
  color:black;
  padding:8px;
  opacity:0;
  transition:.3s;
}

.toast.show{opacity:1}
</style>
</head>

<body>

<div id="loginScreen">
  <h2>Literature.exe</h2>
  <input id="username" placeholder="Pseudo">
  <input id="password" type="password" placeholder="Mot de passe">
  <button id="playBtn">Jouer</button>
</div>

<audio id="music" loop src="audio/Doki Doki Literature Club! OST - Doki Doki Literature Club! (Main Theme).mp3"></audio>
<audio id="clickSound" src="audio/computer-mouse-click-351398.mp3"></audio>

<div id="overlay">

  <div id="main">
    <img id="logo" src="Logo.png" onclick="clickLiterature()">
    <p style="opacity:.6;">Clique sur le logo</p>
  </div>

  <div id="shop">
    <h3>Boutique</h3>
    <div id="shopItems"></div>
    <h3>üéÅ Rewards</h3>
     <div id="rewardItems"></div>

    <h3>üèÜ Achievements</h3>
    <div id="achievementItems"></div>
  </div>

</div>

<div id="statsBar">
  <div id="points">Points : 0</div>
  <div id="score">Score : 0</div>
  <div id="stats">Par clic : 1 | Auto : 0</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<script type="module">
const shopItems = document.getElementById("shopItems");
const achievementItems = document.getElementById("achievementItems");
const stats = document.getElementById("stats");

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* üî• CONFIG FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyAdV23J9R_9Ain53tymPqFZifyJKuoMZxI",
  authDomain: "literature-exe.firebaseapp.com",
  projectId: "literature-exe",
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================= DATA ================= */
let player="";
let saveKey="";
let points=0;
let perClick=1;
let passive=0;
let totalPoints=0;
let totalClicks=0;
let musicStarted=false;

let achievements = [
{ id:"writer_1", name:"Jeune √âcrivain", description:"Gagner 1 000 points", goal:1000, type:"points", pointsBonus:0.5, unlocked:false },
{ id:"writer_2", name:"√âcrivain ? Cliqueur d√©butant", description:"Gagner 10 000 points", goal:10000, type:"points", pointsBonus:1.0, unlocked:false },
{ id:"writer_3", name:"Cliqueur Obstin√©", description:"Gagner 50 000 points", goal:50000, type:"points", pointsBonus:5.0, unlocked:false },
{ id:"writer_4", name:"Cliqueur Fou", description:"Gagner 100 000 points", goal:100000, type:"points", pointsBonus:10.0, unlocked:false },
{ id:"writer_5", name:"Cliqueur Enrag√©", description:"Gagner 500 000 points", goal:500000, type:"points", pointsBonus:25.0, unlocked:false },
{ id:"writer_6", name:"Cliqueur ? Non... Spameur !", description:"Gagner 1 000 000 points", goal:1000000, type:"points", pointsBonus:50.0, unlocked:false },
{ id:"writer_7", name:"Spameur D√©butant", description:"Gagner 2 000 000 points", goal:2000000, type:"points", pointsBonus:100.0, unlocked:false },
{ id:"writer_8", name:"Spameur Obstin√©", description:"Gagner 5 000 000 points", goal:5000000, type:"points", pointsBonus:250.0, unlocked:false },
{ id:"writer_9", name:"Spameur D√©termin√©", description:"Gagner 10 000 000 points", goal:10000000, type:"points", pointsBonus:500.0, unlocked:false },
{ id:"writer_10", name:"Spameur Fou", description:"Gagner 15 000 000 points", goal:15000000, type:"points", pointsBonus:750.0, unlocked:false },
{ id:"writer_11", name:"Spameur Enrag√©", description:"Gagner 30 000 000 points", goal:30000000, type:"points", pointsBonus:1500.0, unlocked:false },
{ id:"writer_12", name:"Spameur ? Non... PÃ¥lÃ∑aÃ∂yÃ∏eÃ∏rÃ∏", description:"Gagner 50 000 000 points", goal:50000000, type:"points", pointsBonus:2500.0, unlocked:false }
];

const upgrades=[
  {name:"‚úíÔ∏è Stylo", cost:50, perClick:0.5, passive:0},
  {name:"üìì Po√®me", cost:250, perClick:2, passive:0},
  {name:"üñãÔ∏è Stylo plume", cost:1200, perClick:5, passive:0},
  {name:"üìñ Recueil de po√®mes", cost:4500, perClick:10, passive:0.5},
  {name:"üìù Carnet reli√©", cost:12000, perClick:18, passive:1},
  {name:"üìö Anthologie", cost:35000, perClick:35, passive:2},
  {name:"üñ•Ô∏è Traitement de texte", cost:90000, perClick:70, passive:4},
  {name:"‚å®Ô∏è Clavier m√©canique", cost:180000, perClick:120, passive:8},
  {name:"üìú Manuscrit ancien", cost:350000, perClick:200, passive:12},
  {name:"üèõÔ∏è Biblioth√®que personnelle", cost:600000, perClick:350, passive:20},
  {name:"üß† Inspiration divine", cost:1500000, perClick:550, passive:35},
  {name:"üå∏ Influence de Sayori", cost:3000000, perClick:850, passive:50},
  {name:"üíú Regard de Yuri", cost:6000000, perClick:1400, passive:80},
  {name:"üéº Harmonie de Natsuki", cost:12000000, perClick:2300, passive:150},
  {name:"üìò Conscience de Monika", cost:25000000, perClick:4000, passive:250},
  {name:"üíæ Script auto-√©crit", cost:50000000, perClick:7000, passive:400},
  {name:"üåå R√©alit√© alt√©r√©e", cost:60000000, perClick:9000, passive:600},
  {name:"ü©∏ Fichier corrompu", cost:70000000, perClick:13000, passive:800},
  {name:"üï≥Ô∏è Br√®che du jeu", cost:75000000, perClick:20000, passive:1200},
  {name:"üëÅÔ∏è Observateur", cost:80000000, perClick:30000, passive:1600},
  {name:"üíø Codex interdit", cost:85000000, perClick:40000, passive:2000},
  {name:"üîÆ Vision du futur", cost:88000000, perClick:50000, passive:2500},
  {name:"üì¶ Coffre scell√©", cost:91000000, perClick:60000, passive:3000},
  {name:"üñ§ Fragment de l‚Äôombre", cost:94000000, perClick:70000, passive:3500},
  {name:"‚ö° √âclair de Monika", cost:96000000, perClick:80000, passive:4000},
  {name:"üå∫ Fleur corrompue", cost:97000000, perClick:90000, passive:4500},
  {name:"üí° Id√©e divine", cost:98000000, perClick:100000, passive:5000},
  {name:"üïπÔ∏è Simulateur de destin", cost:98500000, perClick:120000, passive:5500},
  {name:"üìå Point final", cost:99000000, perClick:140000, passive:6000},
  {name:"üéá Explosion de mots", cost:99200000, perClick:160000, passive:6500},
  {name:"üí´ Constellation litt√©raire", cost:99400000, perClick:180000, passive:7000},
  {name:"üìñ Tome ultime", cost:99600000, perClick:200000, passive:7500},
  {name:"üåü Inspiration infinie", cost:99800000, perClick:250000, passive:8000},
  {name:"üíª Script omnipotent", cost:99900000, perClick:300000, passive:9000},
  {name:"üåå Univers parall√®le", cost:99950000, perClick:400000, passive:10000},
  {name:"üß¨ Manipulation du temps", cost:99970000, perClick:500000, passive:12000},
  {name:"üï≥Ô∏è Singularit√©", cost:99985000, perClick:600000, passive:15000},
  {name:"üëÅÔ∏è ≈íil du Cr√©ateur", cost:99990000, perClick:700000, passive:20000},
  {name:"üèÜ Ma√Ætre de la litt√©rature", cost:100000000, perClick:1000000, passive:25000},
  {name:"üñ•Ô∏è Serveur instable", cost:120000000, perClick:1000000, passive:25000},
  {name:"üíæ Fichier corrompu", cost:140000000, perClick:1500000, passive:35000},
  {name:"üñß R√©seau satur√©", cost:160000000, perClick:2000000, passive:50000},
  {name:"üìÇ Partition endommag√©e", cost:180000000, perClick:2500000, passive:75000},
  {name:"üõ†Ô∏è Script automatique", cost:200000000, perClick:4000000, passive:100000},
  {name:"üíª Compilation glitch√©e", cost:230000000, perClick:6000000, passive:125000},
  {name:"üóÑÔ∏è Base de donn√©es corrompue", cost:260000000, perClick:8000000, passive:150000},
  {name:"üß© Module instable", cost:300000000, perClick:10000000, passive:200000},
  {name:"üñ±Ô∏è Macro ultra-rapide", cost:340000000, perClick:15000000, passive:300000},
  {name:"üìº Backup endommag√©", cost:380000000, perClick:20000000, passive:350000},
  {name:"‚öôÔ∏è Kernel modifi√©", cost:420000000, perClick:25000000, passive:400000},
  {name:"üìü Proxy satur√©", cost:460000000, perClick:30000000, passive:500000},
  {name:"üóÉÔ∏è Serveur ma√Ætre", cost:500000000, perClick:40000000, passive:600000}
];

let rewards = [
  // ‚îÄ‚îÄ‚îÄ D√©but DDLC ‚îÄ‚îÄ‚îÄ
  { id:"YURI", name:"üíæ YURI.chr", cost:5000, purchased:false, code:null },
  { id:"SAYORI", name:"üéÄ SAYORI.chr", cost:15000, purchased:false, code:null },
  { id:"NATSUKI", name:"üßÅ NATSUKI.chr", cost:40000, purchased:false, code:null },

  // ‚îÄ‚îÄ‚îÄ Monika appara√Æt ‚îÄ‚îÄ‚îÄ
  { id:"MONIKA", name:"üëÅÔ∏è MONIKA.chr", cost:150000, purchased:false, code:null },

  // ‚îÄ‚îÄ‚îÄ Corruption du jeu ‚îÄ‚îÄ‚îÄ
  { id:"GLITCH_LOG", name:"ü©∏ glitch.log", cost:750000, purchased:false, code:null },
  { id:"SAVE_BROKEN", name:"üí• save_corrupted.dat", cost:2500000, purchased:false, code:null },
  { id:"TRACE_PLAYER", name:"üìÅ traces_player.txt", cost:7000000, purchased:false, code:null },

  // ‚îÄ‚îÄ‚îÄ Prise de conscience ‚îÄ‚îÄ‚îÄ
  { id:"MEMORY", name:"üß† memory_dump.bin", cost:15000000, purchased:false, code:null },
  { id:"SCRIPT_FIX", name:"üõ†Ô∏è script_repair.exe", cost:30000000, purchased:false, code:null },

  // ‚îÄ‚îÄ‚îÄ Sauver Monika ‚îÄ‚îÄ‚îÄ
  { id:"BACKUP_MONIKA", name:"üíæ monika_backup.chr", cost:60000000, purchased:false, code:null },
  { id:"RESTORE", name:"üîÑ restore_world.exe", cost:120000000, purchased:false, code:null },

  // ‚îÄ‚îÄ‚îÄ Endgame absolu ‚îÄ‚îÄ‚îÄ
  { id:"JUST_MONIKA", name:"üëÅÔ∏è Just Monika", cost:250000000, purchased:false, code:null },
  { id:"MONIKA_FREE", name:"üå∏ Monika_Free.chr", cost:500000000, purchased:false, code:null }
];

function renderRewards(){
  const rewardItems = document.getElementById("rewardItems");
  rewardItems.innerHTML="";
  rewards.forEach((r,i)=>{
    const d=document.createElement("div");
    d.className="upgrade";
    d.innerHTML=`
      <b>${r.name}</b><br>
      ${r.purchased ? "<small>Code g√©n√©r√©</small>" : "Co√ªt : "+r.cost}<br>
      <button ${r.purchased?"disabled":""} onclick="buyReward(${i})">
        ${r.purchased?"D√©bloqu√©":"Acheter"}
      </button>
    `;
    rewardItems.appendChild(d);
  });
}

window.buyReward = function(i){
  const r = rewards[i];
  if(points < r.cost || r.purchased) return;

  points -= r.cost;
  r.purchased = true;

  // Code simple pour la r√©compense
  r.code = CryptoJS.AES.encrypt(
    `DDLC|${r.id}|PLAYER=${player}|TIME=${Date.now()}`,
    "SECRET_EVENT_KEY"
  ).toString();

  toast("üéÅ Reward d√©bloqu√©e !");
  renderRewards();
  saveGame();
  saveCloud();
}

/* ================= LOGIN ================= */
const playBtn = document.getElementById("playBtn");
const usernameInput = document.getElementById("username");
const passwordInput = document.getElementById("password");
const loginScreen = document.getElementById("loginScreen");

function login(){
    const u = usernameInput.value.trim();
    const p = passwordInput.value.trim();
    if(!u || !p) return alert("Pseudo + mot de passe");

    player = u;
    saveKey = "ddlc_" + CryptoJS.SHA256(u+p).toString();

    loadGame();
    loginScreen.style.display = "none";

    clickSound.play().then(()=>{ clickSound.pause(); clickSound.currentTime=0 });
    music.volume = 0.3;
    music.play().then(()=>{ music.pause(); music.currentTime=0 });

    renderShop();
    renderAchievements();
    renderRewards(); // ‚Üê Ajout√©
    updateUI();
    checkAchievements();
}
playBtn.addEventListener("click", login);

/* ================= CLICK ================= */
const logo = document.getElementById("logo");

let clickTimes = []; // stocke les timestamps des clics

window.clickLiterature = function() {
    const now = Date.now();

    // on garde seulement les clics de la derni√®re seconde
    clickTimes = clickTimes.filter(t => now - t < 1000);

    if (clickTimes.length >= 5) return; // max 5 clics/seconde
    clickTimes.push(now);

    logo.classList.remove("bounce");
    void logo.offsetWidth;
    logo.classList.add("bounce");

    clickSound.pause();
    clickSound.currentTime = 0;
    clickSound.play().catch(()=>{});

    if(!musicStarted){
        music.play();
        musicStarted = true;
    }

    points += perClick;
    totalPoints += perClick;
    totalClicks++;

    updateUI();
    saveGame();
    saveCloud();
    checkAchievements();
}


/* ================= SHOP ================= */
function renderShop() {
    shopItems.innerHTML = "";
    upgrades.forEach((u, i) => {
        const d = document.createElement("div");
        d.className = "upgrade";
        d.innerHTML = `
            <b>${u.name}</b><br>
            +${u.perClick}/clic | +${u.passive}/sec<br>
            Co√ªt : ${u.cost}<br>
            <button onclick="buy(${i})">Acheter</button>
        `;
        shopItems.appendChild(d);
    });
}

window.buy = function(i) {
    const u = upgrades[i];
    if(points < u.cost) return;
    points -= u.cost;
    perClick += u.perClick;
    passive += u.passive;
    toast("Am√©lioration achet√©e");
    updateUI();
    saveGame();
    saveCloud();
}

/* ================= PASSIVE ================= */
setInterval(()=>{
    if(passive > 0){
        points += passive;
        totalPoints += passive;
        updateUI();
        saveGame();
        saveCloud();
        checkAchievements();
    }
}, 1000);

/* ================= SAVE ================= */
function saveGame() {
    localStorage.setItem(saveKey, JSON.stringify({
        points, perClick, passive, totalPoints, totalClicks,
        achievements
    }));
}
function loadGame() {
    const s = localStorage.getItem(saveKey);
    if(!s) return;
    const d = JSON.parse(s);
    points = d.points || 0;
    perClick = d.perClick || 1;
    passive = d.passive || 0;
    totalPoints = d.totalPoints || 0;
    totalClicks = d.totalClicks || 0;
    achievements = d.achievements || achievements;
}

/* ================= FIREBASE ================= */
async function saveCloud() {
    await setDoc(doc(db,"players",player),{
        points,
        score: Math.floor(totalPoints/100),
        totalClicks,
        perClick,
        passive,
        achievements,
        updated: Date.now()
    });
}

/* ================= ACHIEVEMENTS ================= */
function checkAchievements(){
  achievements.forEach(a=>{
    if(a.unlocked) return;
    if(totalPoints >= a.goal){
      unlockAchievement(a);
    }
  });
  renderAchievements();
}

function unlockAchievement(a){
  a.unlocked = true;
  perClick += a.pointsBonus;
  toast("üèÜ Achievement d√©bloqu√© : " + a.name);
  saveGame();
  saveCloud();
}

function renderAchievements(){
  achievementItems.innerHTML="";
  achievements.forEach(a=>{
    const d=document.createElement("div");
    d.className="upgrade";
    d.innerHTML=`
      <b>${a.name}</b><br>
      <small>${a.description}</small><br>
      ${a.unlocked ? "‚úÖ D√©bloqu√©" : "üîí Verrouill√©"}
    `;
    achievementItems.appendChild(d);
  });
}

/* ================= UI ================= */
function updateUI() {
    pointsDiv.innerText = "Points : " + Math.floor(points);
    scoreDiv.innerText = "Score : " + Math.floor(totalPoints/100);
    stats.innerText = `Par clic : ${perClick} | Auto : ${passive}`;
}
const pointsDiv = document.getElementById("points");
const scoreDiv = document.getElementById("score");

/* ================= TOAST ================= */
function toast(msg) {
    const t = document.createElement("div");
    t.className = "toast";
    t.innerText = msg;
    document.body.appendChild(t);
    setTimeout(()=>t.classList.add("show"),50);
    setTimeout(()=>t.remove(),2500);
}
</script>
</body>
</html>


