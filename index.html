<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Literature.exe</title>

<style>
html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
    font-family: monospace;
    color: white;
}

body {
    background: url("Club.png") center / cover no-repeat fixed;
}

#overlay {
    display: flex;
    height: 100vh;
}

/* ===== CLASSEMENT ===== */
#leaderboardPanel {
    width: 260px;
    background: rgba(255,182,193,0.85);
    padding: 10px;
    box-sizing: border-box;
}

#leaderboardPanel h2 {
    margin-top: 0;
}

#leaderboard {
    padding-left: 20px;
    color: black;
}

/* ===== CENTRE ===== */
#main {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

#logo {
    width: 360px;
    cursor: pointer;
}

.bounce {
    animation: bounce 0.2s ease;
}

@keyframes bounce {
    0% { transform: scale(1); }
    50% { transform: scale(0.95); }
    100% { transform: scale(1); }
}

/* ===== BOUTIQUE ===== */
#shop {
    width: 320px;
    background: rgba(0,0,0,0.9);
    padding: 10px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
}

.shopSection {
    flex: 1;
    overflow-y: auto;
    margin-bottom: 10px;
}

.upgrade {
    border: 1px solid #444;
    padding: 10px;
    margin-bottom: 10px;
}

button {
    width: 100%;
    background: black;
    color: white;
    border: 1px solid #ff6fa9;
    padding: 6px;
    cursor: pointer;
}

button:hover {
    background: #ff6fa9;
    color: black;
}

button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* ===== STATS ===== */
#statsBar {
    position: fixed;
    bottom: 10px;
    left: 10px;
    background: rgba(0,0,0,0.85);
    border: 1px solid #ff6fa9;
    padding: 10px;
    font-size: 14px;
}

/* ===== TOAST ===== */
.toast {
    position: fixed;
    bottom: 90px;
    left: 10px;
    background: rgba(255,105,180,0.95);
    padding: 10px 15px;
    border-radius: 5px;
    opacity: 0;
    transition: opacity 0.4s, transform 0.4s;
}

.toast.show {
    opacity: 1;
    transform: translateY(-10px);
}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

</head>

<body>

<audio id="music" loop>
  <source src="audio/music.mp3" type="audio/mpeg">
</audio>
<audio id="clickSound">
  <source src="audio/click.mp3" type="audio/mpeg">
</audio>

<div id="overlay">

<!-- CLASSEMENT -->
<div id="leaderboardPanel">
    <h2>Classement</h2>
    <ol id="leaderboard"></ol>
</div>

<!-- CENTRE -->
<div id="main">
    <img id="logo" src="Logo.png" onclick="clickLiterature()">
    <p style="opacity:0.6;">Clique sur le logo</p>
</div>

<!-- BOUTIQUE -->
<div id="shop">
    <h2>Boutique</h2>

    <div class="shopSection">
        <h3>üõí Am√©liorations</h3>
        <div id="shopItems"></div>
    </div>

    <div class="shopSection">
        <h3>üéÅ Rewards</h3>
        <div id="shopRewards"></div>
    </div>
</div>

</div>

<div id="statsBar">
    <div id="points">Points : 0</div>
    <div id="score">Score : 0</div>
    <div id="stats">Par clic : 1 | Auto : 0</div>
</div>

<div id="toastContainer"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script>

/* ===== FIREBASE INIT ===== */
const firebaseConfig = {
  apiKey: "TA_CLE",
  authDomain: "TON_PROJET.firebaseapp.com",
  projectId: "TON_PROJET",
  storageBucket: "TON_PROJET.appspot.com",
  messagingSenderId: "ID",
  appId: "APPID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ===== √âTAT JOUEUR ===== */
let playerName = localStorage.getItem("playerName");

if(!playerName){
    playerName = prompt("Choisis ton pseudo !");
    localStorage.setItem("playerName", playerName);
}
let points = 0;
let score = 0;
let perClick = 1;
let passive = 0;
let totalPointsGained = 0;
let musicStarted = false;
let clickTimes = [];
let unlockedAchievements = [];

/* ===== AM√âLIORATIONS ===== */
const upgrades=[
  {name:"‚úíÔ∏è Stylo", cost:50, perClick:0.5, passive:0},
  {name:"üìì Po√®me", cost:250, perClick:2, passive:0},
  {name:"üñãÔ∏è Stylo plume", cost:1200, perClick:5, passive:0},
  {name:"üìñ Recueil de po√®mes", cost:4500, perClick:10, passive:0.5},
  {name:"üìù Carnet reli√©", cost:12000, perClick:18, passive:1},
  {name:"üìö Anthologie", cost:35000, perClick:35, passive:2},
  {name:"üñ•Ô∏è Traitement de texte", cost:90000, perClick:70, passive:4},
  {name:"‚å®Ô∏è Clavier m√©canique", cost:180000, perClick:120, passive:8},
  {name:"üìú Manuscrit ancien", cost:350000, perClick:200, passive:12},
  {name:"üèõÔ∏è Biblioth√®que personnelle", cost:600000, perClick:350, passive:20},
  {name:"üß† Inspiration divine", cost:1500000, perClick:550, passive:35},
  {name:"üå∏ Influence de Sayori", cost:3000000, perClick:850, passive:50},
  {name:"üíú Regard de Yuri", cost:6000000, perClick:1400, passive:80},
  {name:"üéº Harmonie de Natsuki", cost:12000000, perClick:2300, passive:150},
  {name:"üìò Conscience de Monika", cost:25000000, perClick:4000, passive:250},
  {name:"üíæ Script auto-√©crit", cost:50000000, perClick:7000, passive:400},
  {name:"üåå R√©alit√© alt√©r√©e", cost:60000000, perClick:9000, passive:600},
  {name:"ü©∏ Fichier corrompu", cost:70000000, perClick:13000, passive:800},
  {name:"üï≥Ô∏è Br√®che du jeu", cost:75000000, perClick:20000, passive:1200},
  {name:"üëÅÔ∏è Observateur", cost:80000000, perClick:30000, passive:1600},
  {name:"üíø Codex interdit", cost:85000000, perClick:40000, passive:2000},
  {name:"üîÆ Vision du futur", cost:88000000, perClick:50000, passive:2500},
  {name:"üì¶ Coffre scell√©", cost:91000000, perClick:60000, passive:3000},
  {name:"üñ§ Fragment de l‚Äôombre", cost:94000000, perClick:70000, passive:3500},
  {name:"‚ö° √âclair de Monika", cost:96000000, perClick:80000, passive:4000},
  {name:"üå∫ Fleur corrompue", cost:97000000, perClick:90000, passive:4500},
  {name:"üí° Id√©e divine", cost:98000000, perClick:100000, passive:5000},
  {name:"üïπÔ∏è Simulateur de destin", cost:98500000, perClick:120000, passive:5500},
  {name:"üìå Point final", cost:99000000, perClick:140000, passive:6000},
  {name:"üéá Explosion de mots", cost:99200000, perClick:160000, passive:6500},
  {name:"üí´ Constellation litt√©raire", cost:99400000, perClick:180000, passive:7000},
  {name:"üìñ Tome ultime", cost:99600000, perClick:200000, passive:7500},
  {name:"üåü Inspiration infinie", cost:99800000, perClick:250000, passive:8000},
  {name:"üíª Script omnipotent", cost:99900000, perClick:300000, passive:9000},
  {name:"üåå Univers parall√®le", cost:99950000, perClick:400000, passive:10000},
  {name:"üß¨ Manipulation du temps", cost:99970000, perClick:500000, passive:12000},
  {name:"üï≥Ô∏è Singularit√©", cost:99985000, perClick:600000, passive:15000},
  {name:"üëÅÔ∏è ≈íil du Cr√©ateur", cost:99990000, perClick:700000, passive:20000},
  {name:"üèÜ Ma√Ætre de la litt√©rature", cost:100000000, perClick:1000000, passive:25000},
  {name:"üñ•Ô∏è Serveur instable", cost:120000000, perClick:1000000, passive:25000},
  {name:"üíæ Fichier corrompu", cost:140000000, perClick:1500000, passive:35000},
  {name:"üñß R√©seau satur√©", cost:160000000, perClick:2000000, passive:50000},
  {name:"üìÇ Partition endommag√©e", cost:180000000, perClick:2500000, passive:75000},
  {name:"üõ†Ô∏è Script automatique", cost:200000000, perClick:4000000, passive:100000},
  {name:"üíª Compilation glitch√©e", cost:230000000, perClick:6000000, passive:125000},
  {name:"üóÑÔ∏è Base de donn√©es corrompue", cost:260000000, perClick:8000000, passive:150000},
  {name:"üß© Module instable", cost:300000000, perClick:10000000, passive:200000},
  {name:"üñ±Ô∏è Macro ultra-rapide", cost:340000000, perClick:15000000, passive:300000},
  {name:"üìº Backup endommag√©", cost:380000000, perClick:20000000, passive:350000},
  {name:"‚öôÔ∏è Kernel modifi√©", cost:420000000, perClick:25000000, passive:400000},
  {name:"üìü Proxy satur√©", cost:460000000, perClick:30000000, passive:500000},
  {name:"üóÉÔ∏è Serveur ma√Ætre", cost:500000000, perClick:40000000, passive:600000}
];

/* ===== REWARDS ===== */
const rewards = [
 {id:"YURI", name:"üíæ YURI.chr", cost:10000, type:"BLK", amount:1000, purchased:false, code:null}
];

/* ===== ACHIEVEMENTS ===== */
const achievements = [
  { id:"first_click", title:"Premiers mots", description:"Gagner 10 points", pointsBonus:0.1, condition:()=>totalPointsGained>=10 },
  { id:"writer_1", title:"Jeune √âcrivain", description:"Gagner 1000 points", pointsBonus:0.5, condition:()=>totalPointsGained>=1000 },
  { id:"writer_2", title:"√âcrivain ? Cliqueur d√©butant", description:"Gagner 10000 points", pointsBonus:1.0, condition:()=>totalPointsGained>=10000 },
  { id:"writer_3", title:"Cliqueur Obstin√©", description:"Gagner 50000 points", pointsBonus:5.0, condition:()=>totalPointsGained>=50000 },
  { id:"writer_4", title:"Cliqueur Fou", description:"Gagner 100000 points", pointsBonus:10.0, condition:()=>totalPointsGained>=100000 },
  { id:"writer_5", title:"Cliqueur Enrag√©", description:"Gagner 500000 points", pointsBonus:25.0, condition:()=>totalPointsGained>=500000 },
  { id:"writer_6", title:"Cliqueur ? Non... Spameur !", description:"Gagner 1000000 points", pointsBonus:50.0, condition:()=>totalPointsGained>=1000000 },
  { id:"writer_7", title:"Spameur D√©butant", description:"Gagner 2000000 points", pointsBonus:100.0, condition:()=>totalPointsGained>=2000000 },
  { id:"writer_8", title:"Spameur Obstin√©", description:"Gagner 5000000 points", pointsBonus:250.0, condition:()=>totalPointsGained>=5000000 },
  { id:"writer_9", title:"Spameur D√©termin√©", description:"Gagner 10000000 points", pointsBonus:500.0, condition:()=>totalPointsGained>=10000000 },
  { id:"writer_10", title:"Spameur Fou", description:"Gagner 15000000 points", pointsBonus:750.0, condition:()=>totalPointsGained>=15000000 },
  { id:"writer_11", title:"Spameur Enrag√©", description:"Gagner 30000000 points", pointsBonus:1500.0, condition:()=>totalPointsGained>=30000000 },
  { id:"writer_12", title:"Spameur ? Non... PÃ¥ÕåÕõÕÑÕÑÃóÃôÃ≥Ã¨ÕúÕúlÃ∑ÕåÕåÕçÃßÃùÃùÃÆÃ¶ÃóaÃ∂ÃçÃäÃâÃÄÕÑÃ≠Ã°ÕúyÃ∏ÕùÕñÃ¶Ã§ÕñÃûÃ•Ã©ÃòÃ≤eÃ∏ÃêÃªÕçÃúÃ©ÃºÕâÃ†ÃñrÃ∏ÕÑÃÅÕõÃöÕóÕÑÃøÃéÃÜÕÉÃãÃ†ÃòÕôÃ¢Ã≤Ã∞Ã™Ãü", description:"Gagner 50000000 points", pointsBonus:2500.0, condition:()=>totalPointsGained>=50000000 },
  { id:"poet", title:"Po√®te", description:"Acheter un po√®me", pointsBonus:0.2 }
];

function savePlayer() {
  db.collection("players").doc(playerName).set({
    playerName,
    score,
    points,
    perClick,
    passive,
    rewards,
    unlockedAchievements,
    totalPointsGained,
    lastUpdate: firebase.firestore.FieldValue.serverTimestamp()
  }, { merge: true });
}
db.collection("players")
.orderBy("score","desc")
.limit(10)
.onSnapshot(snapshot => {

    const leaderboard = document.getElementById("leaderboard");
    leaderboard.innerHTML = "";

    snapshot.forEach(doc=>{
        const p = doc.data();

        const li = document.createElement("li");
        li.innerText = `${p.playerName} ‚Äî ${Math.floor(p.score)}`;

        leaderboard.appendChild(li);
    });

});

setInterval(()=>{

    points += passive;

    if(passive > 0){
        totalPointsGained += passive;

        if(totalPointsGained % 100 === 0){
            score++;
        }

        updateUI();
        savePlayer();
    }

},1000);


/* ===== CLICK ===== */
function clickLiterature(){
    const logo = document.getElementById("logo");
    const sound = document.getElementById("clickSound");
    const music = document.getElementById("music");

    logo.classList.remove("bounce");
    void logo.offsetWidth;
    logo.classList.add("bounce");

    sound.currentTime = 0;
    sound.play();

    if(!musicStarted){
        music.volume = 0.4;
        music.play();
        musicStarted = true;
    }

    points += perClick;
    totalPointsGained += perClick;

    if(totalPointsGained % 100 === 0){
        score++;
    }

    updateUI();
    checkAchievements();
    saveGame();
    savePlayer();
}

/* ===== SHOP ===== */
function renderShop(){
    const shopItems = document.getElementById("shopItems");
    shopItems.innerHTML = "";

    upgrades.forEach(up=>{
        const div=document.createElement("div");
        div.className="upgrade";
        div.innerHTML=`
        <strong>${up.name}</strong><br>
        +${up.perClick} clic | +${up.passive}/sec<br>
        Co√ªt : ${up.cost}<br>
        <button onclick='buyUpgrade(${JSON.stringify(up)})'>Acheter</button>`;
        shopItems.appendChild(div);
    });

    const shopRewards=document.getElementById("shopRewards");
    shopRewards.innerHTML="";
    rewards.forEach(r=>{
        const div=document.createElement("div");
        div.className="upgrade";
        div.innerHTML=`
        <strong>${r.name}</strong><br>
        ${r.purchased ? "Code :<br><small>"+r.code+"</small>" : "Co√ªt : "+r.cost}
        <button ${r.purchased?"disabled":""} onclick='buyReward("${r.id}")'>
        ${r.purchased?"D√©bloqu√©":"Acheter"}
        </button>`;
        shopRewards.appendChild(div);
    });
}

/* ===== BUY ===== */
function buyUpgrade(up){
    if(points < up.cost) return;
    points -= up.cost;
    perClick += up.perClick;
    passive += up.passive;
    score += Math.floor(up.cost / 1000);
    toast("Am√©lioration achet√©e");
    updateUI();
    saveGame();
    savePlayer();
}

function buyReward(id){
    const r=rewards.find(x=>x.id===id);
    if(points<r.cost||r.purchased)return;
    points-=r.cost;
    r.purchased=true;
    r.code = CryptoJS.AES.encrypt(
      `DDLC|${r.id}|PLAYER=${playerName}|TYPE=${r.type}|AMOUNT=${r.amount}`,
      "SECRET_KEY"
    ).toString();
    score+=10;
    toast("Reward d√©bloqu√©e !");
    renderShop();
    saveGame();
    savePlayer();
}

/* ===== ACHIEVEMENTS ===== */
function checkAchievements(){
    achievements.forEach(a=>{
        if(!unlockedAchievements.includes(a.id) && a.condition()){
            unlockedAchievements.push(a.id);
            score += a.pointsBonus;
            toast("üèÜ "+a.title);
            savePlayer();
        }
    });
}

/* ===== UI ===== */
function updateUI(){
    document.getElementById("points").innerText="Points : "+Math.floor(points);
    document.getElementById("score").innerText="Score : "+score;
    document.getElementById("stats").innerText=`Par clic : ${perClick} | Auto : ${passive}`;
}

/* ===== TOAST ===== */
function toast(msg){
    const t=document.createElement("div");
    t.className="toast";
    t.innerText=msg;
    document.body.appendChild(t);
    setTimeout(()=>t.classList.add("show"),50);
    setTimeout(()=>t.remove(),3000);
}

/* ===== SAVE ===== */
function saveGame(){
    localStorage.setItem("ddlc_save", JSON.stringify({
        points, score, perClick, passive, totalPointsGained, rewards
    }));
}

function loadGame(){
    const s=JSON.parse(localStorage.getItem("ddlc_save"));
    if(!s)return;
    Object.assign(window,s);
}

/* INIT */
async function initPlayer(){

    const doc = await db.collection("players").doc(playerName).get();

    if(doc.exists){
        const d = doc.data();

        points = d.points || 0;
        score = d.score || 0;
        perClick = d.perClick || 1;
        passive = d.passive || 0;
        rewards = d.rewards || [];
        unlockedAchievements = d.unlockedAchievements || [];
        totalPointsGained = d.totalPointsGained || 0;
    }

    renderShop();
    updateUI();
}

initPlayer();

</script>

</body>
</html>
